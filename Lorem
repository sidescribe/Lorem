#!/bin/bash

# CRM Application Complete Setup Script

# This script creates the entire project structure with all files

echo â€œðŸš€ Creating CRM Applicationâ€¦â€

# Create main project directory

mkdir -p crm-app
cd crm-app

# ============================================

# BACKEND SETUP

# ============================================

echo â€œðŸ“¦ Setting up backendâ€¦â€

mkdir -p backend/src/{config,controllers,middleware,models,routes,utils}

# Backend package.json

cat > backend/package.json << â€˜EOFâ€™
{
â€œnameâ€: â€œcrm-backendâ€,
â€œversionâ€: â€œ1.0.0â€,
â€œdescriptionâ€: â€œCRM Backend API with Express and SQLiteâ€,
â€œmainâ€: â€œsrc/server.jsâ€,
â€œscriptsâ€: {
â€œstartâ€: â€œnode src/server.jsâ€,
â€œdevâ€: â€œnodemon src/server.jsâ€,
â€œseedâ€: â€œnode src/utils/seedDatabase.jsâ€
},
â€œkeywordsâ€: [â€œcrmâ€, â€œapiâ€, â€œexpressâ€],
â€œauthorâ€: â€œâ€,
â€œlicenseâ€: â€œMITâ€,
â€œdependenciesâ€: {
â€œexpressâ€: â€œ^4.18.2â€,
â€œcorsâ€: â€œ^2.8.5â€,
â€œdotenvâ€: â€œ^16.3.1â€,
â€œbcryptjsâ€: â€œ^2.4.3â€,
â€œjsonwebtokenâ€: â€œ^9.0.2â€,
â€œsqlite3â€: â€œ^5.1.6â€,
â€œsequelizeâ€: â€œ^6.35.1â€,
â€œexpress-validatorâ€: â€œ^7.0.1â€,
â€œhelmetâ€: â€œ^7.1.0â€,
â€œmorganâ€: â€œ^1.10.0â€
},
â€œdevDependenciesâ€: {
â€œnodemonâ€: â€œ^3.0.2â€
}
}
EOF

# Backend .env.example

cat > backend/.env.example << â€˜EOFâ€™
PORT=5000
NODE_ENV=development

DB_DIALECT=sqlite
DB_STORAGE=./database.sqlite

JWT_SECRET=your_super_secret_jwt_key_change_this_in_production
JWT_EXPIRE=7d

CORS_ORIGIN=http://localhost:5173
EOF

# Backend .gitignore

cat > backend/.gitignore << â€˜EOFâ€™
node_modules/
.env
*.sqlite
*.sqlite3
logs/
*.log
npm-debug.log*
.DS_Store
Thumbs.db
.vscode/
.idea/
EOF

# Backend server.js

cat > backend/src/server.js << â€˜EOFâ€™
const express = require(â€˜expressâ€™);
const cors = require(â€˜corsâ€™);
const helmet = require(â€˜helmetâ€™);
const morgan = require(â€˜morganâ€™);
require(â€˜dotenvâ€™).config();

const { sequelize } = require(â€™./config/databaseâ€™);
const errorHandler = require(â€™./middleware/errorHandlerâ€™);

const authRoutes = require(â€™./routes/authRoutesâ€™);
const contactRoutes = require(â€™./routes/contactRoutesâ€™);
const leadRoutes = require(â€™./routes/leadRoutesâ€™);
const dealRoutes = require(â€™./routes/dealRoutesâ€™);
const activityRoutes = require(â€™./routes/activityRoutesâ€™);

const app = express();
const PORT = process.env.PORT || 5000;

app.use(helmet());
app.use(cors({
origin: process.env.CORS_ORIGIN || â€˜http://localhost:5173â€™,
credentials: true
}));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(morgan(â€˜devâ€™));

app.get(â€™/api/healthâ€™, (req, res) => {
res.json({ status: â€˜OKâ€™, message: â€˜CRM API is runningâ€™ });
});

app.use(â€™/api/authâ€™, authRoutes);
app.use(â€™/api/contactsâ€™, contactRoutes);
app.use(â€™/api/leadsâ€™, leadRoutes);
app.use(â€™/api/dealsâ€™, dealRoutes);
app.use(â€™/api/activitiesâ€™, activityRoutes);

app.use(errorHandler);

const startServer = async () => {
try {
await sequelize.sync({ alter: true });
console.log(â€˜âœ… Database connected and synchronizedâ€™);

```
app.listen(PORT, () => {
  console.log(`ðŸš€ Server running on port ${PORT}`);
  console.log(`ðŸ“ Environment: ${process.env.NODE_ENV || 'development'}`);
  console.log(`ðŸ”— API available at http://localhost:${PORT}/api`);
});
```

} catch (error) {
console.error(â€˜âŒ Unable to start server:â€™, error);
process.exit(1);
}
};

startServer();

module.exports = app;
EOF

# Backend database.js

cat > backend/src/config/database.js << â€˜EOFâ€™
const { Sequelize } = require(â€˜sequelizeâ€™);
require(â€˜dotenvâ€™).config();

const dbDialect = process.env.DB_DIALECT || â€˜sqliteâ€™;

let sequelize;

if (dbDialect === â€˜sqliteâ€™) {
sequelize = new Sequelize({
dialect: â€˜sqliteâ€™,
storage: process.env.DB_STORAGE || â€˜./database.sqliteâ€™,
logging: process.env.NODE_ENV === â€˜developmentâ€™ ? console.log : false,
});
} else if (dbDialect === â€˜postgresâ€™) {
sequelize = new Sequelize(
process.env.DB_NAME,
process.env.DB_USER,
process.env.DB_PASSWORD,
{
host: process.env.DB_HOST || â€˜localhostâ€™,
port: process.env.DB_PORT || 5432,
dialect: â€˜postgresâ€™,
logging: process.env.NODE_ENV === â€˜developmentâ€™ ? console.log : false,
pool: {
max: 5,
min: 0,
acquire: 30000,
idle: 10000
}
}
);
}

module.exports = { sequelize };
EOF

# Backend errorHandler.js

cat > backend/src/middleware/errorHandler.js << â€˜EOFâ€™
const errorHandler = (err, req, res, next) => {
console.error(â€˜Error:â€™, err);

if (err.name === â€˜SequelizeValidationErrorâ€™) {
return res.status(400).json({
message: â€˜Validation errorâ€™,
errors: err.errors.map(e => ({
field: e.path,
message: e.message
}))
});
}

if (err.name === â€˜SequelizeUniqueConstraintErrorâ€™) {
return res.status(400).json({
message: â€˜Duplicate entryâ€™,
errors: err.errors.map(e => ({
field: e.path,
message: `${e.path} already exists`
}))
});
}

if (err.name === â€˜JsonWebTokenErrorâ€™) {
return res.status(401).json({ message: â€˜Invalid tokenâ€™ });
}

if (err.name === â€˜TokenExpiredErrorâ€™) {
return res.status(401).json({ message: â€˜Token expiredâ€™ });
}

res.status(err.status || 500).json({
message: err.message || â€˜Internal server errorâ€™,
â€¦(process.env.NODE_ENV === â€˜developmentâ€™ && { stack: err.stack })
});
};

module.exports = errorHandler;
EOF

# Backend auth.js middleware

cat > backend/src/middleware/auth.js << â€˜EOFâ€™
const jwt = require(â€˜jsonwebtokenâ€™);
const User = require(â€™../models/Userâ€™);

const auth = async (req, res, next) => {
try {
const token = req.header(â€˜Authorizationâ€™)?.replace(â€™Bearer â€™, â€˜â€™);

```
if (!token) {
  return res.status(401).json({ message: 'No authentication token, access denied' });
}

const decoded = jwt.verify(token, process.env.JWT_SECRET);

const user = await User.findByPk(decoded.id, {
  attributes: { exclude: ['password'] }
});

if (!user || !user.isActive) {
  return res.status(401).json({ message: 'User not found or inactive' });
}

req.user = user;
next();
```

} catch (error) {
res.status(401).json({ message: â€˜Token is not validâ€™ });
}
};

const authorize = (â€¦roles) => {
return (req, res, next) => {
if (!roles.includes(req.user.role)) {
return res.status(403).json({
message: â€˜Access denied. Insufficient permissions.â€™
});
}
next();
};
};

module.exports = { auth, authorize };
EOF

# Backend User.js model

cat > backend/src/models/User.js << â€˜EOFâ€™
const { DataTypes } = require(â€˜sequelizeâ€™);
const bcrypt = require(â€˜bcryptjsâ€™);
const { sequelize } = require(â€™../config/databaseâ€™);

const User = sequelize.define(â€˜Userâ€™, {
id: {
type: DataTypes.INTEGER,
primaryKey: true,
autoIncrement: true
},
firstName: {
type: DataTypes.STRING,
allowNull: false
},
lastName: {
type: DataTypes.STRING,
allowNull: false
},
email: {
type: DataTypes.STRING,
allowNull: false,
unique: true,
validate: {
isEmail: true
}
},
password: {
type: DataTypes.STRING,
allowNull: false
},
role: {
type: DataTypes.ENUM(â€˜adminâ€™, â€˜salesâ€™, â€˜userâ€™),
defaultValue: â€˜userâ€™
},
isActive: {
type: DataTypes.BOOLEAN,
defaultValue: true
}
}, {
timestamps: true,
hooks: {
beforeCreate: async (user) => {
if (user.password) {
user.password = await bcrypt.hash(user.password, 10);
}
},
beforeUpdate: async (user) => {
if (user.changed(â€˜passwordâ€™)) {
user.password = await bcrypt.hash(user.password, 10);
}
}
}
});

User.prototype.comparePassword = async function(candidatePassword) {
return await bcrypt.compare(candidatePassword, this.password);
};

module.exports = User;
EOF

# Backend Contact.js model

cat > backend/src/models/Contact.js << â€˜EOFâ€™
const { DataTypes } = require(â€˜sequelizeâ€™);
const { sequelize } = require(â€™../config/databaseâ€™);
const User = require(â€™./Userâ€™);

const Contact = sequelize.define(â€˜Contactâ€™, {
id: {
type: DataTypes.INTEGER,
primaryKey: true,
autoIncrement: true
},
firstName: {
type: DataTypes.STRING,
allowNull: false
},
lastName: {
type: DataTypes.STRING,
allowNull: false
},
email: {
type: DataTypes.STRING,
allowNull: false,
validate: {
isEmail: true
}
},
phone: {
type: DataTypes.STRING
},
company: {
type: DataTypes.STRING
},
position: {
type: DataTypes.STRING
},
address: {
type: DataTypes.TEXT
},
city: {
type: DataTypes.STRING
},
state: {
type: DataTypes.STRING
},
country: {
type: DataTypes.STRING
},
postalCode: {
type: DataTypes.STRING
},
notes: {
type: DataTypes.TEXT
},
tags: {
type: DataTypes.JSON,
defaultValue: []
},
status: {
type: DataTypes.ENUM(â€˜activeâ€™, â€˜inactiveâ€™, â€˜prospectâ€™),
defaultValue: â€˜activeâ€™
}
}, {
timestamps: true
});

Contact.belongsTo(User, { as: â€˜ownerâ€™, foreignKey: â€˜ownerIdâ€™ });

module.exports = Contact;
EOF

# Backend Lead.js model

cat > backend/src/models/Lead.js << â€˜EOFâ€™
const { DataTypes } = require(â€˜sequelizeâ€™);
const { sequelize } = require(â€™../config/databaseâ€™);
const User = require(â€™./Userâ€™);
const Contact = require(â€™./Contactâ€™);

const Lead = sequelize.define(â€˜Leadâ€™, {
id: {
type: DataTypes.INTEGER,
primaryKey: true,
autoIncrement: true
},
title: {
type: DataTypes.STRING,
allowNull: false
},
description: {
type: DataTypes.TEXT
},
value: {
type: DataTypes.DECIMAL(10, 2),
defaultValue: 0
},
status: {
type: DataTypes.ENUM(â€˜newâ€™, â€˜contactedâ€™, â€˜qualifiedâ€™, â€˜proposalâ€™, â€˜negotiationâ€™, â€˜wonâ€™, â€˜lostâ€™),
defaultValue: â€˜newâ€™
},
source: {
type: DataTypes.STRING
},
priority: {
type: DataTypes.ENUM(â€˜lowâ€™, â€˜mediumâ€™, â€˜highâ€™),
defaultValue: â€˜mediumâ€™
},
expectedCloseDate: {
type: DataTypes.DATE
},
probability: {
type: DataTypes.INTEGER,
defaultValue: 0,
validate: {
min: 0,
max: 100
}
},
notes: {
type: DataTypes.TEXT
}
}, {
timestamps: true
});

Lead.belongsTo(User, { as: â€˜ownerâ€™, foreignKey: â€˜ownerIdâ€™ });
Lead.belongsTo(Contact, { foreignKey: â€˜contactIdâ€™ });

module.exports = Lead;
EOF

# Backend Deal.js model

cat > backend/src/models/Deal.js << â€˜EOFâ€™
const { DataTypes } = require(â€˜sequelizeâ€™);
const { sequelize } = require(â€™../config/databaseâ€™);
const User = require(â€™./Userâ€™);
const Contact = require(â€™./Contactâ€™);

const Deal = sequelize.define(â€˜Dealâ€™, {
id: {
type: DataTypes.INTEGER,
primaryKey: true,
autoIncrement: true
},
title: {
type: DataTypes.STRING,
allowNull: false
},
description: {
type: DataTypes.TEXT
},
value: {
type: DataTypes.DECIMAL(10, 2),
allowNull: false
},
stage: {
type: DataTypes.ENUM(â€˜prospectingâ€™, â€˜qualificationâ€™, â€˜proposalâ€™, â€˜negotiationâ€™, â€˜closed_wonâ€™, â€˜closed_lostâ€™),
defaultValue: â€˜prospectingâ€™
},
probability: {
type: DataTypes.INTEGER,
defaultValue: 0,
validate: {
min: 0,
max: 100
}
},
expectedCloseDate: {
type: DataTypes.DATE
},
actualCloseDate: {
type: DataTypes.DATE
},
notes: {
type: DataTypes.TEXT
}
}, {
timestamps: true
});

Deal.belongsTo(User, { as: â€˜ownerâ€™, foreignKey: â€˜ownerIdâ€™ });
Deal.belongsTo(Contact, { foreignKey: â€˜contactIdâ€™ });

module.exports = Deal;
EOF

# Backend Activity.js model

cat > backend/src/models/Activity.js << â€˜EOFâ€™
const { DataTypes } = require(â€˜sequelizeâ€™);
const { sequelize } = require(â€™../config/databaseâ€™);
const User = require(â€™./Userâ€™);
const Contact = require(â€™./Contactâ€™);
const Lead = require(â€™./Leadâ€™);
const Deal = require(â€™./Dealâ€™);

const Activity
